package tableConstructors;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import tableConstructors.*;

public class PharmacyEmployeeViewAllPrescriptionsGUI extends JFrame {

    private PharmacyEmployee employee;

    public PharmacyEmployeeViewGUI(PharmacyEmployee employee) {
        this.employee = employee;
        initializeUI();
    }

    public PharmacyManagerGUI() {
        setTitle("Prescription Viewer");
        setSize(600, 400);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        JTextArea prescriptionTextArea = new JTextArea();
        prescriptionTextArea.setEditable(false);

        JScrollPane scrollPane = new JScrollPane(prescriptionTextArea);
        scrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);

        JButton viewPrescriptionsButton = new JButton("View Prescriptions");
        viewPrescriptionsButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                prescriptionTextArea.setText("");
                viewPrescriptions(prescriptionTextArea);
            }
        });

        JPanel buttonPanel = new JPanel();
        buttonPanel.add(viewPrescriptionsButton);

        getContentPane().setLayout(new BorderLayout());
        getContentPane().add(scrollPane, BorderLayout.CENTER);
        getContentPane().add(buttonPanel, BorderLayout.SOUTH);
    }

    private void viewPrescriptions(JTextArea prescriptionTextArea) {
        Connection myConnection;
        PreparedStatement preparedStmt;
        String pharmacyId = getPharmacyId();

        try {
            myConnection = openDBConnection();

            // Prepare the SQL select statement.
            String queryString = "SELECT * FROM Pharmacy_Prescriptions WHERE PHARMACY_ID = ?";

            preparedStmt = myConnection.prepareStatement(queryString);

            preparedStmt.setString(1, pharmacyId);

            ResultSet rs = preparedStmt.executeQuery();

            // Append the column headers
            prescriptionTextArea.append("PRESCRIPTION_ID\tPATIENT_ID\tINSURANCE_ID\tAMOUNT_OWED\n");

            // Iterate through the result set and append each row
            while (rs.next()) {
                String prescriptionId = rs.getString("PRESCRIPTION_ID");
                String patientId = rs.getString("PATIENT_ID");
                String insuranceId = rs.getString("INSURANCE_ID");
                double amountOwed = rs.getDouble("AMOUNT_OWED");
                prescriptionTextArea.append(prescriptionId + "\t\t" + patientId + "\t\t" + insuranceId + "\t\t" + amountOwed + "\n");
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                new PharmacyManagerGUI().setVisible(true);
            }
        });
    }
}
}